<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; background: #f0f0f0; }
        canvas { display: block; }
        #startScreen, #quizOverlay, #passwordPanel, #adminPanel, #scorePage, #achievementsModal, #powerUpOverlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            pointer-events: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #startScreen { display: block; }
        #quizOverlay, #passwordPanel, #adminPanel, #scorePage, #achievementsModal, #powerUpOverlay { display: none; }
        button {
            margin: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            pointer-events: auto;
            transition: transform 0.2s, background 0.2s;
        }
        button:hover { transform: scale(1.05); }
        button:disabled { background: #cccccc; cursor: not-allowed; }
        #answer1 { background: #ff4d4d; color: white; }
        #answer2 { background: #4d79ff; color: white; }
        #answer3 { background: #4dff4d; color: white; }
        #answer4 { background: #ffff4d; color: black; }
        #prevBtn, #nextBtn, #returnBtn, #dailyChallengeBtn, #joinBtn, #logoutBtn, #redoMissedBtn, #achievementsBtn, #closeAchievementsBtn, #usePowerUpBtn, #skipPowerUpBtn, #powerUp1Btn, #powerUp2Btn, #powerUp3Btn { background: #888; color: white; }
        input, select {
            margin: 8px;
            padding: 8px;
            width: 90%;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            pointer-events: auto;
        }
        #questionList, #scoreDetails, #achievementsList {
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
            margin: 10px 0;
        }
        #questionList div, #scoreDetails div, #achievementsList div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }
        #timer { position: absolute; top: 15px; left: 15px; font-size: 18px; z-index: 10; }
        #score { position: absolute; top: 15px; right: 15px; font-size: 18px; z-index: 10; }
        #powerUpDisplay { position: absolute; top: 50px; left: 15px; font-size: 16px; z-index: 10; }
        #questionImage { max-width: 100%; max-height: 200px; margin: 10px 0; }
        .countdown { font-size: 24px; color: #d81b60; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        #cheatToggle { margin: 10px 0; font-size: 14px; }
        #feedback {
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #feedback.correct { color: green; }
        #feedback.incorrect { color: red; }
        #playerNameInput, #playerPasswordInput { margin: 10px 0; }
        #highScoreDisplay { font-size: 14px; margin: 10px 0; }
        #starsDisplay { font-size: 24px; margin: 10px 0; }
        .star { color: gold; }
        #achievementsDisplay { font-size: 16px; margin: 10px 0; }
        .achievement-badge { margin: 0 5px; font-size: 20px; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <canvas id="gameCanvas"></canvas>
    <div id="startScreen">
        <h2>Quiz Game</h2>
        <input id="playerNameInput" type="text" placeholder="Enter your name" maxlength="20">
        <input id="playerPasswordInput" type="password" placeholder="Enter your password" maxlength="20">
        <button id="joinBtn">Join</button>
        <div id="highScoreDisplay"></div>
        <div id="achievementsDisplay"></div>
        <div id="gameModes" style="display: none;">
            <select id="difficultySelect">
                <option value="easy">Easy (25s)</option>
                <option value="medium" selected>Medium (20s)</option>
                <option value="hard">Hard (15s)</option>
            </select>
            <button id="singlePlayerBtn">Single-Player</button>
            <button id="dailyChallengeBtn">Daily Challenge</button>
            <button id="practiceBtn">Practice Mode</button>
            <button id="adminBtn">Admin</button>
            <button id="achievementsBtn">Achievements</button>
            <button id="logoutBtn">Logout</button>
        </div>
    </div>
    <div id="timer">Time: 20</div>
    <div id="score">Score: 0</div>
    <div id="powerUpDisplay">Power-Up: None</div>
    <div id="quizOverlay">
        <h2 id="question"></h2>
        <img id="questionImage" src="" style="display: none;">
        <div id="feedback"></div>
        <button id="answer1"></button>
        <button id="answer2"></button>
        <button id="answer3"></button>
        <button id="answer4"></button>
        <div>
            <button id="prevBtn">Previous</button>
            <button id="nextBtn">Next</button>
            <button id="usePowerUpBtn">Use Power-Up</button>
        </div>
    </div>
    <div id="passwordPanel">
        <h2>Admin Access</h2>
        <input id="adminPassword" type="password" placeholder="Enter password">
        <button id="submitPasswordBtn">Submit</button>
        <button id="cancelPasswordBtn">Cancel</button>
    </div>
    <div id="adminPanel">
        <h2>Admin Panel</h2>
        <h3>Add/Edit Question</h3>
        <input id="newQuestion" placeholder="Question" type="text">
        <input id="questionImageInput" type="file" accept="image/*">
        <input id="newAnswer1" placeholder="Answer 1" type="text">
        <input id="newAnswer2" placeholder="Answer 2" type="text">
        <input id="newAnswer3" placeholder="Answer 3" type="text">
        <input id="newAnswer4" placeholder="Answer 4" type="text">
        <select id="correctAnswer">
            <option value="0">Answer 1</option>
            <option value="1">Answer 2</option>
            <option value="2">Answer 3</option>
            <option value="3">Answer 4</option>
        </select>
        <button id="saveQuestionBtn">Save</button>
        <h3>Questions</h3>
        <div id="questionList"></div>
        <label id="cheatToggle"><input type="checkbox" id="cheatModeCheckbox"> Enable Cheats (Auto-select correct answers)</label>
        <button id="closeAdminBtn">Close</button>
    </div>
    <div id="scorePage">
        <h2>Game Over!</h2>
        <h3 id="playerNameDisplay"></h3>
        <h3 id="finalScore"></h3>
        <div id="starsDisplay"></div>
        <div id="achievementsEarned"></div>
        <h3>Results</h3>
        <div id="scoreDetails"></div>
        <button id="returnBtn">Return</button>
        <button id="redoMissedBtn" style="display: none;">Redo Missed Questions</button>
    </div>
    <div id="achievementsModal">
        <h2>Your Achievements</h2>
        <div id="achievementsList"></div>
        <button id="closeAchievementsBtn">Close</button>
    </div>
    <div id="powerUpOverlay">
        <h2>Choose a Power-Up</h2>
        <div id="powerUpTimer">Time Left: 10</div>
        <button id="powerUp1Btn"></button>
        <button id="powerUp2Btn"></button>
        <button id="powerUp3Btn"></button>
        <button id="skipPowerUpBtn">Skip</button>
    </div>
    <script>
        window.onload = () => {
            const originalQuestions = [
                {
                    question: "Who was the leader of the Montgomery Bus Boycott in 1955–1956?",
                    answers: ["Martin Luther King Jr.", "Rosa Parks", "Malcolm X", "John Lewis"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1964 law outlawed discrimination based on race, color, religion, sex, or national origin?",
                    answers: ["Civil Rights Act", "Voting Rights Act", "Fair Housing Act", "Equal Pay Act"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Which event involved a 1963 march on Washington, D.C., where Martin Luther King Jr. gave his 'I Have a Dream' speech?",
                    answers: ["March on Washington", "Selma to Montgomery March", "Freedom Rides", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who refused to give up her seat on a Montgomery bus, sparking the bus boycott?",
                    answers: ["Rosa Parks", "Coretta Scott King", "Ella Baker", "Fannie Lou Hamer"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1965 act prohibited racial discrimination in voting?",
                    answers: ["Voting Rights Act", "Civil Rights Act", "Emancipation Proclamation", "Thirteenth Amendment"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What was the name of the 1961 campaign where activists rode buses to challenge segregation in the South?",
                    answers: ["Freedom Rides", "March on Washington", "Selma to Montgomery March", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who was a key organizer of the Student Nonviolent Coordinating Committee (SNCC)?",
                    answers: ["Ella Baker", "Coretta Scott King", "Rosa Parks", "Dorothy Height"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1963 campaign in Alabama led to the use of fire hoses and police dogs against protesters?",
                    answers: ["Birmingham Campaign", "Freedom Rides", "Selma to Montgomery March", "March on Washington"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Which 1965 march from Selma to Montgomery was led by Martin Luther King Jr. to demand voting rights?",
                    answers: ["Selma to Montgomery March", "March on Washington", "Freedom Rides", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who was a prominent Civil Rights leader known for his advocacy of Black nationalism and self-defense?",
                    answers: ["Malcolm X", "Martin Luther King Jr.", "John Lewis", "James Farmer"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1954 Supreme Court case declared segregated schools unconstitutional?",
                    answers: ["Brown v. Board of Education", "Plessy v. Ferguson", "Loving v. Virginia", "Roe v. Wade"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who was the first African American student to integrate the University of Mississippi in 1962?",
                    answers: ["James Meredith", "Medgar Evers", "Thurgood Marshall", "Fred Shuttlesworth"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1968 act addressed discrimination in housing, passed shortly after MLK's assassination?",
                    answers: ["Fair Housing Act", "Civil Rights Act", "Voting Rights Act", "Equal Pay Act"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who led the National Association for the Advancement of Colored People (NAACP) during the Civil Rights era?",
                    answers: ["Roy Wilkins", "A. Philip Randolph", "Bayard Rustin", "Whitney Young"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What event on August 28, 1963, drew over 200,000 people to the Lincoln Memorial for civil rights?",
                    answers: ["March on Washington", "Selma to Montgomery March", "Freedom Rides", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                }
            ];

            let questions = [];
            let currentQuestion = 0;
            let score = 0;
            let timeLeft = 20;
            let initialTime = 20;
            let timerInterval;
            let gameMode = '';
            let editingIndex = -1;
            let cheatMode = false;
            let hasAnswered = false;
            let answersSubmitted = [];
            let userAnswers = [];
            let playerName = '';
            let playerPassword = '';
            let highScore = 0;
            let totalTimeTaken = 0;
            let timePerQuestion = [];
            let missedQuestions = [];
            let achievements = { fastFinger: false, perfectRound: false };
            let activePowerUp = null;
            let powerUpTimerInterval;
            let powerUpTimeLeft = 10;
            let doublePointsActive = false;
            let freezeTimerActive = false;
            let extraTimeActive = false;
            let bonusPointsActive = false;
            let scene, camera, renderer, scroll;

            const BASE_POINTS = 100;
            const MULTIPLIER = 50;
            const DAILY_QUESTIONS_COUNT = 5;
            const FAST_THRESHOLD = 30;
            const MODERATE_THRESHOLD = 50;
            const POWER_UP_CHANCE = 0.2; // 20% chance to get a power-up opportunity

            const powerUps = [
                { name: "Skip a Question", description: "Skip the current question without penalty" },
                { name: "Double Points", description: "Double the points for the next correct answer" },
                { name: "Freeze Timer", description: "Freeze the timer for the current question" },
                { name: "Extra Time", description: "Add 10 seconds to the current timer" },
                { name: "Bonus Points", description: "Gain 50 bonus points immediately" },
                { name: "Reveal Answer", description: "Highlight the correct answer for this question" },
                { name: "Second Chance", description: "Get a second attempt if you answer incorrectly" },
                { name: "Half Answers", description: "Eliminate two incorrect answers" }
            ];

            const correctSound = new Howl({ src: ['https://freesound.org/data/previews/171/171671_2437358-lq.mp3'] });
            const incorrectSound = new Howl({ src: ['https://freesound.org/data/previews/535/535634_3246398-lq.mp3'] });

            // Simple hash function for password
            function simpleHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString();
            }

            // Player Profile Management
            function loadPlayerProfile() {
                const savedName = localStorage.getItem('playerName');
                const savedPassword = localStorage.getItem('playerPassword');
                if (savedName && savedPassword) {
                    document.getElementById('playerNameInput').value = savedName;
                    document.getElementById('playerPasswordInput').value = '';
                    document.getElementById('joinBtn').textContent = 'Login';
                } else {
                    localStorage.clear();
                    document.getElementById('playerNameInput').value = '';
                    document.getElementById('playerPasswordInput').value = '';
                    document.getElementById('joinBtn').textContent = 'Join';
                }
                playerName = '';
                playerPassword = '';
                highScore = 0;
                document.getElementById('gameModes').style.display = 'none';
                updateHighScoreDisplay();
                loadAchievements();
                updateAchievementsDisplay();
            }

            function savePlayerProfile() {
                localStorage.setItem('playerName', playerName);
                localStorage.setItem('playerPassword', simpleHash(playerPassword));
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('highScore_' + simpleHash(playerName), highScore);
                    updateHighScoreDisplay();
                }
                saveAchievements();
            }

            function validateLogin() {
                const inputName = document.getElementById('playerNameInput').value.trim();
                const inputPassword = document.getElementById('playerPasswordInput').value.trim();
                const savedName = localStorage.getItem('playerName');
                const savedPassword = localStorage.getItem('playerPassword');

                if (!inputName || !inputPassword) {
                    alert('Please enter both a name and a password!');
                    return false;
                }

                if (savedName && savedPassword) {
                    if (savedName === inputName && savedPassword === simpleHash(inputPassword)) {
                        playerName = inputName;
                        playerPassword = inputPassword;
                        highScore = parseInt(localStorage.getItem('highScore_' + simpleHash(playerName)) || 0);
                        loadAchievements();
                        return true;
                    } else {
                        alert('Incorrect name or password!');
                        return false;
                    }
                } else {
                    playerName = inputName;
                    playerPassword = inputPassword;
                    highScore = 0;
                    achievements = { fastFinger: false, perfectRound: false };
                    savePlayerProfile();
                    return true;
                }
            }

            function logout() {
                playerName = '';
                playerPassword = '';
                highScore = 0;
                document.getElementById('playerNameInput').value = localStorage.getItem('playerName') || '';
                document.getElementById('playerPasswordInput').value = '';
                document.getElementById('joinBtn').textContent = 'Login';
                document.getElementById('gameModes').style.display = 'none';
                updateHighScoreDisplay();
                loadAchievements();
                updateAchievementsDisplay();
            }

            function updateHighScoreDisplay() {
                const display = document.getElementById('highScoreDisplay');
                if (playerName) {
                    display.textContent = `High Score: ${highScore} (by ${playerName})`;
                } else {
                    display.textContent = '';
                }
            }

            // Achievements Management
            function loadAchievements() {
                const saved = localStorage.getItem('achievements_' + simpleHash(playerName));
                if (saved) {
                    achievements = JSON.parse(saved);
                } else {
                    achievements = { fastFinger: false, perfectRound: false };
                }
            }

            function saveAchievements() {
                localStorage.setItem('achievements_' + simpleHash(playerName), JSON.stringify(achievements));
                updateAchievementsDisplay();
            }

            function updateAchievementsDisplay() {
                const display = document.getElementById('achievementsDisplay');
                let badges = '';
                if (achievements.fastFinger) badges += '<span class="achievement-badge" title="Fast Finger: Answered in <2s">⚡</span>';
                if (achievements.perfectRound) badges += '<span class="achievement-badge" title="Perfect Round">🏆</span>';
                display.innerHTML = badges ? `Achievements: ${badges}` : '';
            }

            function checkAchievements(timeUsed) {
                let earned = false;
                if (timeUsed < 2 && !achievements.fastFinger) {
                    achievements.fastFinger = true;
                    earned = true;
                }
                if (gameMode !== 'practice') {
                    const allCorrect = userAnswers.every((answer, i) => answer === questions[i].correct);
                    if (allCorrect && !achievements.perfectRound) {
                        achievements.perfectRound = true;
                        earned = true;
                    }
                }
                if (earned) {
                    saveAchievements();
                    const earnedDisplay = document.getElementById('achievementsEarned');
                    earnedDisplay.innerHTML = 'New Achievement Unlocked! 🎉';
                    setTimeout(() => {
                        earnedDisplay.innerHTML = '';
                    }, 3000);
                }
            }

            function showAchievements() {
                const modal = document.getElementById('achievementsModal');
                const list = document.getElementById('achievementsList');
                list.innerHTML = '';
                const achievementData = [
                    { name: 'Fast Finger', description: 'Answered a question in under 2 seconds', earned: achievements.fastFinger, badge: '⚡' },
                    { name: 'Perfect Round', description: 'Completed a game mode with all answers correct', earned: achievements.perfectRound, badge: '🏆' }
                ];
                achievementData.forEach((ach) => {
                    const div = document.createElement('div');
                    div.textContent = `${ach.name}: ${ach.description} - ${ach.earned ? 'Earned! ' + ach.badge : 'Not Earned'}`;
                    list.appendChild(div);
                });
                modal.style.display = 'block';
            }

            function closeAchievements() {
                document.getElementById('achievementsModal').style.display = 'none';
            }

            // Power-Up Management
            function updatePowerUpDisplay() {
                const display = document.getElementById('powerUpDisplay');
                if (activePowerUp) {
                    display.textContent = `Power-Up: ${activePowerUp.name}`;
                } else {
                    display.textContent = 'Power-Up: None';
                }
                document.getElementById('usePowerUpBtn').disabled = !activePowerUp;
            }

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            function showPowerUpSelection() {
                const overlay = document.getElementById('powerUpOverlay');
                powerUpTimeLeft = 10;
                document.getElementById('powerUpTimer').textContent = `Time Left: ${powerUpTimeLeft}`;
                const shuffledPowerUps = shuffleArray([...powerUps]).slice(0, 3);
                ['powerUp1Btn', 'powerUp2Btn', 'powerUp3Btn'].forEach((id, index) => {
                    const btn = document.getElementById(id);
                    btn.textContent = `${shuffledPowerUps[index].name}: ${shuffledPowerUps[index].description}`;
                    btn.onclick = () => selectPowerUp(shuffledPowerUps[index]);
                });
                overlay.style.display = 'block';
                clearInterval(powerUpTimerInterval);
                powerUpTimerInterval = setInterval(() => {
                    powerUpTimeLeft--;
                    document.getElementById('powerUpTimer').textContent = `Time Left: ${powerUpTimeLeft}`;
                    if (powerUpTimeLeft <= 0) {
                        clearInterval(powerUpTimerInterval);
                        overlay.style.display = 'none';
                        proceedToNextQuestion();
                    }
                }, 1000);
            }

            function selectPowerUp(powerUp) {
                activePowerUp = powerUp;
                updatePowerUpDisplay();
                document.getElementById('powerUpOverlay').style.display = 'none';
                clearInterval(powerUpTimerInterval);
                proceedToNextQuestion();
            }

            function usePowerUp() {
                if (!activePowerUp) return;
                const q = questions[currentQuestion];
                if (activePowerUp.name === 'Skip a Question') {
                    if (currentQuestion < questions.length - 1) {
                        currentQuestion++;
                        answersSubmitted[currentQuestion] = true;
                        userAnswers[currentQuestion] = -1;
                        timePerQuestion[currentQuestion] = 0;
                        showQuestion(currentQuestion);
                    } else {
                        endGame();
                    }
                } else if (activePowerUp.name === 'Double Points') {
                    doublePointsActive = true;
                } else if (activePowerUp.name === 'Freeze Timer') {
                    freezeTimerActive = true;
                    clearInterval(timerInterval);
                    document.getElementById('timer').textContent = `Time: ${timeLeft} (Frozen)`;
                } else if (activePowerUp.name === 'Extra Time') {
                    extraTimeActive = true;
                    timeLeft += 10;
                    document.getElementById('timer').textContent = `Time: ${timeLeft}`;
                    extraTimeActive = false;
                    startTimer();
                } else if (activePowerUp.name === 'Bonus Points') {
                    bonusPointsActive = true;
                    score += 50;
                    document.getElementById('score').textContent = `Score: ${score}`;
                    bonusPointsActive = false;
                } else if (activePowerUp.name === 'Reveal Answer') {
                    const correctBtn = document.getElementById(`answer${q.correct + 1}`);
                    correctBtn.style.background = '#FFD700';
                } else if (activePowerUp.name === 'Second Chance') {
                    hasAnswered = false;
                    answersSubmitted[currentQuestion] = false;
                    ['answer1', 'answer2', 'answer3', 'answer4'].forEach((id, i) => {
                        const btn = document.getElementById(id);
                        btn.disabled = false;
                        btn.style.pointerEvents = 'auto';
                    });
                    startTimer();
                } else if (activePowerUp.name === 'Half Answers') {
                    let incorrectIndices = [0, 1, 2, 3].filter(i => i !== q.correct);
                    incorrectIndices = shuffleArray(incorrectIndices).slice(0, 2);
                    incorrectIndices.forEach(i => {
                        const btn = document.getElementById(`answer${i + 1}`);
                        btn.disabled = true;
                        btn.style.pointerEvents = 'none';
                        btn.style.opacity = '0.5';
                    });
                }
                if (activePowerUp.name !== 'Double Points' && activePowerUp.name !== 'Second Chance') {
                    activePowerUp = null;
                }
                updatePowerUpDisplay();
            }

            function proceedToNextQuestion() {
                if (currentQuestion < questions.length - 1) {
                    currentQuestion++;
                    showQuestion(currentQuestion);
                } else {
                    endGame();
                }
            }

            // Dynamic Backgrounds and Interactive Visuals
            function initThreeJS() {
                scene = new THREE.Scene();
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('gameCanvas') });
                renderer.setSize(window.innerWidth, window.innerHeight);
                setBackground();
                const stage = new THREE.Mesh(
                    new THREE.BoxGeometry(10, 0.2, 5),
                    new THREE.MeshBasicMaterial({ color: 0x222222 })
                );
                stage.position.y = -1;
                scene.add(stage);
                const screen = new THREE.Mesh(
                    new THREE.PlaneGeometry(6, 3),
                    new THREE.MeshBasicMaterial({ color: 0xdddddd })
                );
                screen.position.set(0, 1, -2);
                scene.add(screen);

                // Initialize scroll for interactive visuals
                const scrollGeometry = new THREE.PlaneGeometry(2, 0.5);
                const scrollMaterial = new THREE.MeshBasicMaterial({ color: 0xccaa77, side: THREE.DoubleSide });
                scroll = new THREE.Mesh(scrollGeometry, scrollMaterial);
                scroll.position.set(0, 2, -1);
                scroll.scale.y = 0; // Start rolled up
                scene.add(scroll);

                camera.position.set(0, 2, 5);
                camera.lookAt(0, 0, 0);
                function animate() {
                    requestAnimationFrame(animate);
                    renderer.render(scene, camera);
                }
                animate();
            }

            function setBackground() {
                const difficulty = document.getElementById('difficultySelect').value;
                if (difficulty === 'easy') {
                    renderer.setClearColor(0x000033); // Space background
                    addStars();
                } else if (difficulty === 'medium') {
                    renderer.setClearColor(0x228B22); // Jungle background
                    addTrees();
                } else if (difficulty === 'hard') {
                    renderer.setClearColor(0x87CEEB); // Beach background
                    addWaves();
                }
            }

            function clearBackgroundObjects() {
                while (scene.children.length > 0) {
                    scene.remove(scene.children[0]);
                }
                const stage = new THREE.Mesh(
                    new THREE.BoxGeometry(10, 0.2, 5),
                    new THREE.MeshBasicMaterial({ color: 0x222222 })
                );
                stage.position.y = -1;
                scene.add(stage);
                const screen = new THREE.Mesh(
                    new THREE.PlaneGeometry(6, 3),
                    new THREE.MeshBasicMaterial({ color: 0xdddddd })
                );
                screen.position.set(0, 1, -2);
                scene.add(screen);
                const scrollGeometry = new THREE.PlaneGeometry(2, 0.5);
                const scrollMaterial = new THREE.MeshBasicMaterial({ color: 0xccaa77, side: THREE.DoubleSide });
                scroll = new THREE.Mesh(scrollGeometry, scrollMaterial);
                scroll.position.set(0, 2, -1);
                scroll.scale.y = 0;
                scene.add(scroll);
            }

            function addStars() {
                clearBackgroundObjects();
                for (let i = 0; i < 100; i++) {
                    const starGeometry = new THREE.SphereGeometry(0.05, 8, 8);
                    const starMaterial = new THREE.MeshBasicMaterial({ color: 0xffffff });
                    const star = new THREE.Mesh(starGeometry, starMaterial);
                    star.position.set(
                        (Math.random() - 0.5) * 20,
                        (Math.random() - 0.5) * 20,
                        (Math.random() - 0.5) * 20
                    );
                    scene.add(star);
                }
            }

            function addTrees() {
                clearBackgroundObjects();
                for (let i = 0; i < 5; i++) {
                    const treeTrunkGeometry = new THREE.CylinderGeometry(0.1, 0.1, 1);
                    const trunkMaterial = new THREE.MeshBasicMaterial({ color: 0x8B4513 });
                    const trunk = new THREE.Mesh(treeTrunkGeometry, trunkMaterial);
                    trunk.position.set((i - 2) * 2, 0, -3);
                    scene.add(trunk);

                    const foliageGeometry = new THREE.ConeGeometry(0.5, 1, 8);
                    const foliageMaterial = new THREE.MeshBasicMaterial({ color: 0x228B22 });
                    const foliage = new THREE.Mesh(foliageGeometry, foliageMaterial);
                    foliage.position.set((i - 2) * 2, 0.5, -3);
                    scene.add(foliage);
                }
            }

            function addWaves() {
                clearBackgroundObjects();
                const sandGeometry = new THREE.PlaneGeometry(20, 10);
                const sandMaterial = new THREE.MeshBasicMaterial({ color: 0xF4A460, side: THREE.DoubleSide });
                const sand = new THREE.Mesh(sandGeometry, sandMaterial);
                sand.rotation.x = Math.PI / 2;
                sand.position.y = -1.1;
                scene.add(sand);

                for (let i = 0; i < 3; i++) {
                    const waveGeometry = new THREE.PlaneGeometry(20, 0.2);
                    const waveMaterial = new THREE.MeshBasicMaterial({ color: 0x4682B4, side: THREE.DoubleSide });
                    const wave = new THREE.Mesh(waveGeometry, waveMaterial);
                    wave.rotation.x = Math.PI / 2;
                    wave.position.set(0, -1, -2 + i * 0.5);
                    scene.add(wave);
                }
            }

            function animateScroll(isCorrect) {
                if (isCorrect) {
                    let scale = 0;
                    const animationInterval = setInterval(() => {
                        scale += 0.1;
                        scroll.scale.y = scale;
                        if (scale >= 1) {
                            clearInterval(animationInterval);
                        }
                    }, 50);
                } else {
                    scroll.scale.y = 0;
                }
            }

            // Difficulty Settings
            function setDifficulty() {
                const difficulty = document.getElementById('difficultySelect').value;
                if (difficulty === 'easy') initialTime = 25;
                else if (difficulty === 'medium') initialTime = 20;
                else if (difficulty === 'hard') initialTime = 15;
                timeLeft = initialTime;
                document.getElementById('timer').textContent = `Time: ${timeLeft}`;
                setBackground();
            }

            // Daily Challenge Seed Function
            function getDailySeed() {
                const now = new Date();
                return now.getFullYear() * 10000 + (now.getMonth() + 1) * 100 + now.getDate();
            }

            // Seeded Random Number Generator
            function mulberry32(a) {
                return function() {
                    let t = a += 0x6D2B79F5;
                    t = Math.imul(t ^ t >>> 15, t | 1);
                    t ^= t + Math.imul(t ^ t >>> 7, t | 61);
                    return ((t ^ t >>> 14) >>> 0) / 4294967296;
                }
            }

            // Shuffle Array (Fisher-Yates algorithm)
            function shuffle(array, randomFunc = Math.random) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(randomFunc() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Shuffle Questions and Answers
            function shuffleQuestionsAndAnswers() {
                questions = JSON.parse(JSON.stringify(originalQuestions));
                questions = shuffle(questions);
                questions.forEach(q => {
                    const correctAnswer = q.answers[q.correct];
                    q.answers = shuffle([...q.answers]);
                    q.correct = q.answers.indexOf(correctAnswer);
                });
                answersSubmitted = new Array(questions.length).fill(false);
                userAnswers = new Array(questions.length).fill(-1);
                timePerQuestion = new Array(questions.length).fill(0);
                totalTimeTaken = 0;
            }

            // Daily Challenge Questions
            function loadDailyChallengeQuestions() {
                const seed = getDailySeed();
                const seededRandom = mulberry32(seed);
                let dailyQuestions = [...originalQuestions];
                dailyQuestions = shuffle(dailyQuestions, seededRandom);
                questions = dailyQuestions.slice(0, DAILY_QUESTIONS_COUNT);
                questions.forEach(q => {
                    const correctAnswer = q.answers[q.correct];
                    q.answers = shuffle([...q.answers], seededRandom);
                    q.correct = q.answers.indexOf(correctAnswer);
                });
                answersSubmitted = new Array(questions.length).fill(false);
                userAnswers = new Array(questions.length).fill(-1);
                timePerQuestion = new Array(questions.length).fill(0);
                totalTimeTaken = 0;
            }

            // Load Missed Questions
            function loadMissedQuestions() {
                questions = missedQuestions.map(index => JSON.parse(JSON.stringify(originalQuestions[index])));
                questions.forEach(q => {
                    const correctAnswer = q.answers[q.correct];
                    q.answers = shuffle([...q.answers]);
                    q.correct = q.answers.indexOf(correctAnswer);
                });
                answersSubmitted = new Array(questions.length).fill(false);
                userAnswers = new Array(questions.length).fill(-1);
                timePerQuestion = new Array(questions.length).fill(0);
                totalTimeTaken = 0;
                gameMode = 'redo';
            }

            // Display Feedback
            function showFeedback(isCorrect) {
                const feedbackDiv = document.getElementById('feedback');
                feedbackDiv.textContent = isCorrect ? "Correct!" : "Incorrect!";
                feedbackDiv.className = isCorrect ? "correct" : "incorrect";
                feedbackDiv.style.opacity = '1';
                setTimeout(() => {
                    feedbackDiv.style.opacity = '0';
                }, 2000);
                animateScroll(isCorrect);
            }

            // Game Logic
            function showQuestion(index) {
                if (questions.length === 0 || index >= questions.length) {
                    alert('No questions available! Add questions in Admin.');
                    document.getElementById('startScreen').style.display = 'block';
                    return;
                }
                hasAnswered = answersSubmitted[index] || false;
                const q = questions[index];
                document.getElementById('question').textContent = q.question;
                const img = document.getElementById('questionImage');
                img.src = q.image || '';
                img.style.display = q.image ? 'block' : 'none';
                ['answer1', 'answer2', 'answer3', 'answer4'].forEach((id, i) => {
                    const btn = document.getElementById(id);
                    btn.textContent = q.answers[i];
                    btn.disabled = hasAnswered;
                    btn.style.pointerEvents = hasAnswered ? 'none' : 'auto';
                    btn.style.background = '';
                    btn.style.opacity = '1';
                    btn.onclick = null;
                    btn.addEventListener('click', () => {
                        if (!hasAnswered) {
                            console.log(`Button ${id} clicked, answer: ${i}, hasAnswered: ${hasAnswered}`);
                            hasAnswered = true;
                            answersSubmitted[index] = true;
                            userAnswers[index] = i;
                            checkAnswer(i);
                        } else {
                            console.log(`Button ${id} clicked but already answered`);
                        }
                    });
                    console.log(`Bound onclick for ${id}, disabled: ${btn.disabled}, pointer-events: ${btn.style.pointerEvents}`);
                });
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                prevBtn.disabled = currentQuestion === 0;
                nextBtn.disabled = currentQuestion === questions.length - 1 || !answersSubmitted[index];
                document.getElementById('quizOverlay').style.display = 'block';
                if (gameMode !== 'practice' && !hasAnswered) startTimer();
                if (cheatMode && !hasAnswered) {
                    console.log('Cheat mode active, auto-answering');
                    setTimeout(() => {
                        if (!hasAnswered) {
                            console.log('Cheat mode selecting correct answer');
                            hasAnswered = true;
                            answersSubmitted[index] = true;
                            userAnswers[index] = q.correct;
                            checkAnswer(q.correct);
                        }
                    }, 1000);
                }
            }

            function startTimer() {
                if (freezeTimerActive) return;
                timeLeft = initialTime;
                document.getElementById('timer').textContent = `Time: ${timeLeft}`;
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer').textContent = `Time: ${timeLeft}`;
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        if (!hasAnswered) {
                            console.log('Timer expired, auto-submitting');
                            hasAnswered = true;
                            answersSubmitted[currentQuestion] = true;
                            userAnswers[currentQuestion] = -1;
                            checkAnswer(-1);
                        }
                    }
                }, 1000);
            }

            function checkAnswer(selected) {
                console.log(`checkAnswer called with selected: ${selected}, hasAnswered: ${hasAnswered}`);
                clearInterval(timerInterval);
                const q = questions[currentQuestion];
                let isCorrect = selected === q.correct;
                const timeUsed = initialTime - timeLeft;
                timePerQuestion[currentQuestion] = timeUsed;
                totalTimeTaken += timeUsed;
                try {
                    if (isCorrect) {
                        let points = gameMode === 'practice' || gameMode === 'redo' ? 0 : BASE_POINTS + (timeLeft * MULTIPLIER);
                        if (doublePointsActive) {
                            points *= 2;
                            doublePointsActive = false;
                            activePowerUp = null;
                            updatePowerUpDisplay();
                        }
                        score += points;
                        document.getElementById('score').textContent = `Score: ${score}`;
                        correctSound.play();
                        showFeedback(true);
                        console.log('Correct answer selected, score updated:', score);
                    } else {
                        incorrectSound.play();
                        showFeedback(false);
                        console.log('Incorrect answer selected');
                        if (activePowerUp && activePowerUp.name === 'Second Chance') {
                            hasAnswered = false;
                            answersSubmitted[currentQuestion] = false;
                            ['answer1', 'answer2', 'answer3', 'answer4'].forEach((id, i) => {
                                const btn = document.getElementById(id);
                                btn.disabled = false;
                                btn.style.pointerEvents = 'auto';
                                btn.style.background = '';
                                btn.style.opacity = '1';
                            });
                            activePowerUp = null;
                            updatePowerUpDisplay();
                            startTimer();
                            return;
                        }
                    }
                    freezeTimerActive = false;
                    extraTimeActive = false;
                    checkAchievements(timeUsed);
                    if (currentQuestion === questions.length - 1) {
                        endGame();
                    } else {
                        if (Math.random() < POWER_UP_CHANCE) {
                            showPowerUpSelection();
                        } else {
                            proceedToNextQuestion();
                        }
                    }
                } catch (e) {
                    console.error('Error in checkAnswer:', e);
                    alert('Error processing answer. Please try again.');
                }
            }

            function calculateStars() {
                if (gameMode !== 'daily') return 0;
                if (totalTimeTaken <= FAST_THRESHOLD) return 2;
                if (totalTimeTaken <= MODERATE_THRESHOLD) return 1;
                return 0;
            }

            function showScorePage() {
                document.getElementById('quizOverlay').style.display = 'none';
                const scorePage = document.getElementById('scorePage');
                const playerNameDisplay = document.getElementById('playerNameDisplay');
                const finalScore = document.getElementById('finalScore');
                const starsDisplay = document.getElementById('starsDisplay');
                const scoreDetails = document.getElementById('scoreDetails');
                const redoBtn = document.getElementById('redoMissedBtn');
                playerNameDisplay.textContent = playerName ? `Player: ${playerName}` : '';
                finalScore.textContent = (gameMode === 'practice' || gameMode === 'redo') ? "Practice Complete!" : `Final Score: ${score}`;
                const stars = calculateStars();
                starsDisplay.innerHTML = gameMode === 'daily' ? `Stars: ${'★'.repeat(stars)}${'☆'.repeat(2 - stars)} (${totalTimeTaken}s)` : '';
                scoreDetails.innerHTML = '';
                missedQuestions = [];
                questions.forEach((q, i) => {
                    const div = document.createElement('div');
                    const userAnswer = userAnswers[i] === -1 ? "No answer" : q.answers[userAnswers[i]];
                    const correctAnswer = q.answers[q.correct];
                    const isCorrect = userAnswers[i] === q.correct;
                    const timeTaken = timePerQuestion[i];
                    div.textContent = `${i + 1}. ${q.question} - Your answer: ${userAnswer} (${isCorrect ? 'Correct' : 'Incorrect'}) - Time: ${timeTaken}s`;
                    if (!isCorrect) {
                        const correctSpan = document.createElement('span');
                        correctSpan.style.color = 'green';
                        correctSpan.textContent = ` Correct: ${correctAnswer}`;
                        div.appendChild(correctSpan);
                        missedQuestions.push(i);
                    }
                    scoreDetails.appendChild(div);
                });
                redoBtn.style.display = missedQuestions.length > 0 && gameMode !== 'redo' ? 'block' : 'none';
                scorePage.style.display = 'block';
                savePlayerProfile();
            }

            function endGame() {
                activePowerUp = null;
                doublePointsActive = false;
                freezeTimerActive = false;
                extraTimeActive = false;
                bonusPointsActive = false;
                updatePowerUpDisplay();
                showScorePage();
            }

            function returnToMainPage() {
                document.getElementById('scorePage').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
                document.getElementById('score').textContent = 'Score: 0';
                currentQuestion = 0;
                score = 0;
                hasAnswered = false;
                answersSubmitted = [];
                userAnswers = [];
                timePerQuestion = [];
                totalTimeTaken = 0;
                activePowerUp = null;
                doublePointsActive = false;
                freezeTimerActive = false;
                extraTimeActive = false;
                bonusPointsActive = false;
                updatePowerUpDisplay();
                document.getElementById('gameModes').style.display = 'block';
                updateHighScoreDisplay();
            }

            // Admin Logic
            function showPasswordPanel() {
                console.log('Admin button clicked');
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('passwordPanel').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }

            function closePasswordPanel() {
                console.log('Cancel password clicked');
                document.getElementById('passwordPanel').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
            }

            function verifyPassword() {
                console.log('Submit password clicked');
                try {
                    const password = document.getElementById('adminPassword').value.trim();
                    if (password === "1234") {
                        console.log('Password correct, opening admin panel');
                        document.getElementById('passwordPanel').style.display = 'none';
                        document.getElementById('adminPanel').style.display = 'block';
                        updateQuestionList();
                    } else {
                        console.log('Incorrect password');
                        alert("Incorrect password!");
                    }
                } catch (e) {
                    console.error('Error verifying password:', e);
                    alert('Error verifying password.');
                }
            }

            function closeAdmin() {
                console.log('Close admin clicked');
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
                editingIndex = -1;
                clearForm();
            }

            function saveQuestion() {
                console.log('Save question clicked');
                try {
                    const question = document.getElementById('newQuestion').value.trim();
                    const answers = [
                        document.getElementById('newAnswer1').value.trim(),
                        document.getElementById('newAnswer2').value.trim(),
                        document.getElementById('newAnswer3').value.trim(),
                        document.getElementById('newAnswer4').value.trim()
                    ];
                    const correct = parseInt(document.getElementById('correctAnswer').value);
                    const imageInput = document.getElementById('questionImageInput');
                    let image = '';
                    if (imageInput.files && imageInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            image = e.target.result;
                            saveQuestionData({ question, answers, correct, image });
                        };
                        reader.readAsDataURL(imageInput.files[0]);
                    } else {
                        saveQuestionData({ question, answers, correct, image });
                    }
                } catch (e) {
                    console.error('Error saving question:', e);
                    alert('Error saving question.');
                }
            }

            function saveQuestionData({ question, answers, correct, image }) {
                if (!question) {
                    alert("Question cannot be empty!");
                    return;
                }
                if (answers.some(a => !a)) {
                    alert("All answers must be filled!");
                    return;
                }
                if (isNaN(correct) || correct < 0 || correct > 3) {
                    alert("Select a valid correct answer!");
                    return;
                }
                if (question.length > 100 || answers.some(a => a.length > 50)) {
                    alert("Question or answers too long!");
                    return;
                }
                if (editingIndex === -1) {
                    originalQuestions.push({ question, answers, correct, image });
                    console.log('Question added:', question);
                    alert("Question added!");
                } else {
                    originalQuestions[editingIndex] = { question, answers, correct, image };
                    console.log('Question edited:', question);
                    alert("Question updated!");
                    editingIndex = -1;
                }
                updateQuestionList();
                clearForm();
            }

            function editQuestion(index) {
                console.log(`Edit question ${index} clicked`);
                try {
                    editingIndex = index;
                    const q = originalQuestions[index];
                    document.getElementById('newQuestion').value = q.question;
                    document.getElementById('newAnswer1').value = q.answers[0];
                    document.getElementById('newAnswer2').value = q.answers[1];
                    document.getElementById('newAnswer3').value = q.answers[2];
                    document.getElementById('newAnswer4').value = q.answers[3];
                    document.getElementById('correctAnswer').value = q.correct;
                    document.getElementById('questionImageInput').value = '';
                    document.getElementById('adminPanel').scrollIntoView();
                } catch (e) {
                    console.error('Error editing question:', e);
                    alert('Error editing question.');
                }
            }

            function removeQuestion(index) {
                console.log(`Remove question ${index} clicked`);
                try {
                    if (confirm('Are you sure you want to delete this question?')) {
                        originalQuestions.splice(index, 1);
                        console.log('Question removed');
                        updateQuestionList();
                        alert('Question deleted!');
                    }
                } catch (e) {
                    console.error('Error removing question:', e);
                    alert('Error removing question.');
                }
            }

            function updateQuestionList() {
                console.log('Updating question list');
                try {
                    const questionList = document.getElementById('questionList');
                    questionList.innerHTML = '';
                    originalQuestions.forEach((q, i) => {
                        const div = document.createElement('div');
                        const truncated = q.question.length > 30 ? q.question.substring(0, 27) + '...' : q.question;
                        div.textContent = `${i + 1}. ${truncated}`;
                        const editBtn = document.createElement('button');
                        editBtn.textContent = 'Edit';
                        editBtn.onclick = () => editQuestion(i);
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = 'Delete';
                        deleteBtn.onclick = () => removeQuestion(i);
                        div.appendChild(editBtn);
                        div.appendChild(deleteBtn);
                        questionList.appendChild(div);
                    });
                } catch (e) {
                    console.error('Error updating question list:', e);
                    alert('Error updating question list.');
                }
            }

            function clearForm() {
                document.getElementById('newQuestion').value = '';
                document.getElementById('questionImageInput').value = '';
                document.getElementById('newAnswer1').value = '';
                document.getElementById('newAnswer2').value = '';
                document.getElementById('newAnswer3').value = '';
                document.getElementById('newAnswer4').value = '';
                document.getElementById('correctAnswer').value = '0';
            }

            // Initialize
            try {
                initThreeJS();
                loadPlayerProfile();
                updatePowerUpDisplay();

                document.getElementById('joinBtn').onclick = () => {
                    if (validateLogin()) {
                        document.getElementById('joinBtn').textContent = 'Update';
                        document.getElementById('gameModes').style.display = 'block';
                        updateHighScoreDisplay();
                    }
                };

                document.getElementById('logoutBtn').onclick = () => {
                    console.log('Logout button clicked');
                    logout();
                };

                document.getElementById('singlePlayerBtn').onclick = () => {
                    console.log('Single-player button clicked');
                    gameMode = 'single';
                    document.getElementById('startScreen').style.display = 'none';
                    setDifficulty();
                    shuffleQuestionsAndAnswers();
                    showQuestion(0);
                };

                document.getElementById('dailyChallengeBtn').onclick = () => {
                    console.log('Daily Challenge button clicked');
                    gameMode = 'daily';
                    document.getElementById('startScreen').style.display = 'none';
                    setDifficulty();
                    loadDailyChallengeQuestions();
                    showQuestion(0);
                };

                document.getElementById('practiceBtn').onclick = () => {
                    console.log('Practice button clicked');
                    gameMode = 'practice';
                    document.getElementById('startScreen').style.display = 'none';
                    setDifficulty();
                    shuffleQuestionsAndAnswers();
                    showQuestion(0);
                };

                document.getElementById('redoMissedBtn').onclick = () => {
                    console.log('Redo Missed Questions button clicked');
                    document.getElementById('scorePage').style.display = 'none';
                    setDifficulty();
                    loadMissedQuestions();
                    showQuestion(0);
                };

                document.getElementById('adminBtn').onclick = () => {
                    console.log('Admin button clicked');
                    showPasswordPanel();
                };

                document.getElementById('submitPasswordBtn').onclick = () => {
                    console.log('Submit password button clicked');
                    verifyPassword();
                };

                document.getElementById('cancelPasswordBtn').onclick = () => {
                    console.log('Cancel password clicked');
                    closePasswordPanel();
                };

                document.getElementById('saveQuestionBtn').onclick = () => {
                    console.log('Save question button clicked');
                    saveQuestion();
                };

                document.getElementById('closeAdminBtn').onclick = () => {
                    console.log('Close admin button clicked');
                    closeAdmin();
                };

                document.getElementById('cheatModeCheckbox').onchange = () => {
                    cheatMode = document.getElementById('cheatModeCheckbox').checked;
                    console.log('Cheat mode:', cheatMode ? 'enabled' : 'disabled');
                };

                document.getElementById('prevBtn').onclick = () => {
                    if (currentQuestion > 0) {
                        currentQuestion--;
                        showQuestion(currentQuestion);
                    }
                };

                document.getElementById('nextBtn').onclick = () => {
                    if (currentQuestion < questions.length - 1 && answersSubmitted[currentQuestion]) {
                        currentQuestion++;
                        showQuestion(currentQuestion);
                    } else if (currentQuestion === questions.length - 1 && answersSubmitted[currentQuestion]) {
                        endGame();
                    }
                };

                document.getElementById('returnBtn').onclick = () => {
                    console.log('Return button clicked');
                    returnToMainPage();
                };

                document.getElementById('achievementsBtn').onclick = () => {
                    console.log('Achievements button clicked');
                    showAchievements();
                };

                document.getElementById('closeAchievementsBtn').onclick = () => {
                    console.log('Close achievements button clicked');
                    closeAchievements();
                };

                document.getElementById('usePowerUpBtn').onclick = () => {
                    console.log('Use Power-Up button clicked');
                    usePowerUp();
                };

                document.getElementById('skipPowerUpBtn').onclick = () => {
                    console.log('Skip Power-Up selection');
                    document.getElementById('powerUpOverlay').style.display = 'none';
                    clearInterval(powerUpTimerInterval);
                    proceedToNextQuestion();
                };

                console.log('Event listeners attached successfully');
            } catch (e) {
                console.error('Error during initialization:', e);
                alert('Failed to initialize game. Please refresh the page.');
            }
        };
    </script>
</body>
</html>