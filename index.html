<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Game</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; background: #f0f0f0; }
        canvas { display: block; }
        #startScreen, #quizOverlay, #passwordPanel, #adminPanel, #scorePage {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            z-index: 1000;
            pointer-events: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        #startScreen { display: block; }
        #quizOverlay, #passwordPanel, #adminPanel, #scorePage { display: none; }
        button {
            margin: 8px;
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            pointer-events: auto;
            transition: transform 0.2s, background 0.2s;
        }
        button:hover { transform: scale(1.05); }
        button:disabled { background: #cccccc; cursor: not-allowed; }
        #answer1 { background: #ff4d4d; color: white; }
        #answer2 { background: #4d79ff; color: white; }
        #answer3 { background: #4dff4d; color: white; }
        #answer4 { background: #ffff4d; color: black; }
        #prevBtn, #nextBtn, #finishBtn { background: #888; color: white; }
        input, select {
            margin: 8px;
            padding: 8px;
            width: 90%;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
            pointer-events: auto;
        }
        #questionList, #scoreDetails {
            max-height: 200px;
            overflow-y: auto;
            font-size: 14px;
            margin: 10px 0;
        }
        #questionList div, #scoreDetails div {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 8px 0;
        }
        #timer { position: absolute; top: 15px; left: 15px; font-size: 18px; z-index: 10; }
        #score { position: absolute; top: 15px; right: 15px; font-size: 18px; z-index: 10; }
        #questionImage { max-width: 100%; max-height: 200px; margin: 10px 0; }
        .countdown { font-size: 24px; color: #d81b60; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        #cheatToggle { margin: 10px 0; font-size: 14px; }
        #feedback {
            margin: 10px 0;
            font-size: 18px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s;
        }
        #feedback.correct { color: green; }
        #feedback.incorrect { color: red; }
    </style>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/howler/2.2.3/howler.min.js"></script>
    <canvas id="gameCanvas"></canvas>
    <div id="startScreen">
        <h2>Quiz Game</h2>
        <button id="singlePlayerBtn">Single-Player</button>
        <button id="practiceBtn">Practice Mode</button>
        <button id="adminBtn">Admin</button>
    </div>
    <div id="timer">Time: 10</div>
    <div id="score">Score: 0</div>
    <div id="quizOverlay">
        <h2 id="question"></h2>
        <img id="questionImage" src="" style="display: none;">
        <div id="feedback"></div>
        <button id="answer1"></button>
        <button id="answer2"></button>
        <button id="answer3"></button>
        <button id="answer4"></button>
        <div>
            <button id="prevBtn">Previous</button>
            <button id="nextBtn">Next</button>
        </div>
    </div>
    <div id="passwordPanel">
        <h2>Admin Access</h2>
        <input id="adminPassword" type="password" placeholder="Enter password">
        <button id="submitPasswordBtn">Submit</button>
        <button id="cancelPasswordBtn">Cancel</button>
    </div>
    <div id="adminPanel">
        <h2>Admin Panel</h2>
        <h3>Add/Edit Question</h3>
        <input id="newQuestion" placeholder="Question" type="text">
        <input id="questionImageInput" type="file" accept="image/*">
        <input id="newAnswer1" placeholder="Answer 1" type="text">
        <input id="newAnswer2" placeholder="Answer 2" type="text">
        <input id="newAnswer3" placeholder="Answer 3" type="text">
        <input id="newAnswer4" placeholder="Answer 4" type="text">
        <select id="correctAnswer">
            <option value="0">Answer 1</option>
            <option value="1">Answer 2</option>
            <option value="2">Answer 3</option>
            <option value="3">Answer 4</option>
        </select>
        <button id="saveQuestionBtn">Save</button>
        <h3>Questions</h3>
        <div id="questionList"></div>
        <label id="cheatToggle"><input type="checkbox" id="cheatModeCheckbox"> Enable Cheats (Auto-select correct answers)</label>
        <button id="closeAdminBtn">Close</button>
    </div>
    <div id="scorePage">
        <h2>Game Over!</h2>
        <h3 id="finalScore"></h3>
        <h3>Results</h3>
        <div id="scoreDetails"></div>
        <button id="finishBtn">Finish</button>
    </div>
    <script>
        window.onload = () => {
            const originalQuestions = [
                {
                    question: "Who was the leader of the Montgomery Bus Boycott in 1955â€“1956?",
                    answers: ["Martin Luther King Jr.", "Rosa Parks", "Malcolm X", "John Lewis"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1964 law outlawed discrimination based on race, color, religion, sex, or national origin?",
                    answers: ["Civil Rights Act", "Voting Rights Act", "Fair Housing Act", "Equal Pay Act"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Which event involved a 1963 march on Washington, D.C., where Martin Luther King Jr. gave his 'I Have a Dream' speech?",
                    answers: ["March on Washington", "Selma to Montgomery March", "Freedom Rides", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who refused to give up her seat on a Montgomery bus, sparking the bus boycott?",
                    answers: ["Rosa Parks", "Coretta Scott King", "Ella Baker", "Fannie Lou Hamer"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1965 act prohibited racial discrimination in voting?",
                    answers: ["Voting Rights Act", "Civil Rights Act", "Emancipation Proclamation", "Thirteenth Amendment"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What was the name of the 1961 campaign where activists rode buses to challenge segregation in the South?",
                    answers: ["Freedom Rides", "March on Washington", "Selma to Montgomery March", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who was a key organizer of the Student Nonviolent Coordinating Committee (SNCC)?",
                    answers: ["Ella Baker", "Coretta Scott King", "Rosa Parks", "Dorothy Height"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1963 campaign in Alabama led to the use of fire hoses and police dogs against protesters?",
                    answers: ["Birmingham Campaign", "Freedom Rides", "Selma to Montgomery March", "March on Washington"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Which 1965 march from Selma to Montgomery was led by Martin Luther King Jr. to demand voting rights?",
                    answers: ["Selma to Montgomery March", "March on Washington", "Freedom Rides", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who was a prominent Civil Rights leader known for his advocacy of Black nationalism and self-defense?",
                    answers: ["Malcolm X", "Martin Luther King Jr.", "John Lewis", "James Farmer"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1954 Supreme Court case declared segregated schools unconstitutional?",
                    answers: ["Brown v. Board of Education", "Plessy v. Ferguson", "Loving v. Virginia", "Roe v. Wade"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who was the first African American student to integrate the University of Mississippi in 1962?",
                    answers: ["James Meredith", "Medgar Evers", "Thurgood Marshall", "Fred Shuttlesworth"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What 1968 act addressed discrimination in housing, passed shortly after MLK's assassination?",
                    answers: ["Fair Housing Act", "Civil Rights Act", "Voting Rights Act", "Equal Pay Act"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "Who led the National Association for the Advancement of Colored People (NAACP) during the Civil Rights era?",
                    answers: ["Roy Wilkins", "A. Philip Randolph", "Bayard Rustin", "Whitney Young"],
                    correct: 0,
                    image: ""
                },
                {
                    question: "What event on August 28, 1963, drew over 200,000 people to the Lincoln Memorial for civil rights?",
                    answers: ["March on Washington", "Selma to Montgomery March", "Freedom Rides", "Birmingham Campaign"],
                    correct: 0,
                    image: ""
                }
            ];

            let questions = [];
            let currentQuestion = 0;
            let score = 0;
            let timeLeft = 10;
            let timerInterval;
            let gameMode = '';
            let editingIndex = -1;
            let cheatMode = false;
            let hasAnswered = false;
            let answersSubmitted = [];
            let userAnswers = [];

            const correctSound = new Howl({ src: ['https://freesound.org/data/previews/171/171671_2437358-lq.mp3'] });
            const incorrectSound = new Howl({ src: ['https://freesound.org/data/previews/535/535634_3246398-lq.mp3'] });

            // Three.js Setup
            function initThreeJS() {
                const scene = new THREE.Scene();
                const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('gameCanvas') });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setClearColor(0x0000ff);
                const stage = new THREE.Mesh(
                    new THREE.BoxGeometry(10, 0.2, 5),
                    new THREE.MeshBasicMaterial({ color: 0x222222 })
                );
                stage.position.y = -1;
                scene.add(stage);
                const screen = new THREE.Mesh(
                    new THREE.PlaneGeometry(6, 3),
                    new THREE.MeshBasicMaterial({ color: 0xdddddd })
                );
                screen.position.set(0, 1, -2);
                scene.add(screen);
                camera.position.set(0, 2, 5);
                camera.lookAt(0, 0, 0);
                function animate() {
                    requestAnimationFrame(animate);
                    renderer.render(scene, camera);
                }
                animate();
            }

            // Shuffle Array (Fisher-Yates algorithm)
            function shuffle(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Shuffle Questions and Answers
            function shuffleQuestionsAndAnswers() {
                questions = JSON.parse(JSON.stringify(originalQuestions));
                questions = shuffle(questions);
                questions.forEach(q => {
                    const correctAnswer = q.answers[q.correct];
                    q.answers = shuffle([...q.answers]);
                    q.correct = q.answers.indexOf(correctAnswer);
                });
                answersSubmitted = new Array(questions.length).fill(false);
                userAnswers = new Array(questions.length).fill(-1);
            }

            // Display Feedback
            function showFeedback(isCorrect) {
                const feedbackDiv = document.getElementById('feedback');
                feedbackDiv.textContent = isCorrect ? "Correct!" : "Incorrect!";
                feedbackDiv.className = isCorrect ? "correct" : "incorrect";
                feedbackDiv.style.opacity = '1';
                setTimeout(() => {
                    feedbackDiv.style.opacity = '0';
                }, 2000);
            }

            // Game Logic
            function showQuestion(index) {
                if (questions.length === 0 || index >= questions.length) {
                    alert('No questions available! Add questions in Admin.');
                    document.getElementById('startScreen').style.display = 'block';
                    return;
                }
                hasAnswered = answersSubmitted[index] || false;
                const q = questions[index];
                document.getElementById('question').textContent = q.question;
                const img = document.getElementById('questionImage');
                img.src = q.image || '';
                img.style.display = q.image ? 'block' : 'none';
                ['answer1', 'answer2', 'answer3', 'answer4'].forEach((id, i) => {
                    const btn = document.getElementById(id);
                    btn.textContent = q.answers[i];
                    btn.disabled = hasAnswered;
                    btn.style.pointerEvents = hasAnswered ? 'none' : 'auto';
                    btn.onclick = null;
                    btn.addEventListener('click', () => {
                        if (!hasAnswered) {
                            console.log(`Button ${id} clicked, answer: ${i}, hasAnswered: ${hasAnswered}`);
                            hasAnswered = true;
                            answersSubmitted[index] = true;
                            userAnswers[index] = i;
                            checkAnswer(i);
                        } else {
                            console.log(`Button ${id} clicked but already answered`);
                        }
                    });
                    console.log(`Bound onclick for ${id}, disabled: ${btn.disabled}, pointer-events: ${btn.style.pointerEvents}`);
                });
                const prevBtn = document.getElementById('prevBtn');
                const nextBtn = document.getElementById('nextBtn');
                prevBtn.disabled = currentQuestion === 0;
                nextBtn.disabled = currentQuestion === questions.length - 1 || !answersSubmitted[index];
                document.getElementById('quizOverlay').style.display = 'block';
                if (gameMode !== 'practice' && !hasAnswered) startTimer();
                if (cheatMode && !hasAnswered) {
                    console.log('Cheat mode active, auto-answering');
                    setTimeout(() => {
                        if (!hasAnswered) {
                            console.log('Cheat mode selecting correct answer');
                            hasAnswered = true;
                            answersSubmitted[index] = true;
                            userAnswers[index] = q.correct;
                            checkAnswer(q.correct);
                        }
                    }, 1000);
                }
            }

            function startTimer() {
                timeLeft = 10;
                document.getElementById('timer').textContent = `Time: ${timeLeft}`;
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timeLeft--;
                    document.getElementById('timer').textContent = `Time: ${timeLeft}`;
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        if (!hasAnswered) {
                            console.log('Timer expired, auto-submitting');
                            hasAnswered = true;
                            answersSubmitted[currentQuestion] = true;
                            userAnswers[currentQuestion] = -1;
                            checkAnswer(-1);
                        }
                    }
                }, 1000);
            }

            function checkAnswer(selected) {
                console.log(`checkAnswer called with selected: ${selected}, hasAnswered: ${hasAnswered}`);
                clearInterval(timerInterval);
                const q = questions[currentQuestion];
                let isCorrect = selected === q.correct;
                try {
                    if (isCorrect) {
                        score += gameMode === 'practice' ? 0 : Math.max(100, 100 * timeLeft);
                        document.getElementById('score').textContent = `Score: ${score}`;
                        correctSound.play();
                        showFeedback(true);
                        console.log('Correct answer selected, score updated:', score);
                    } else {
                        incorrectSound.play();
                        showFeedback(false);
                        console.log('Incorrect answer selected');
                    }
                    showQuestion(currentQuestion);
                } catch (e) {
                    console.error('Error in checkAnswer:', e);
                    alert('Error processing answer. Please try again.');
                }
            }

            function showScorePage() {
                document.getElementById('quizOverlay').style.display = 'none';
                const scorePage = document.getElementById('scorePage');
                const finalScore = document.getElementById('finalScore');
                const scoreDetails = document.getElementById('scoreDetails');
                finalScore.textContent = gameMode === 'practice' ? "Practice Complete!" : `Final Score: ${score}`;
                scoreDetails.innerHTML = '';
                questions.forEach((q, i) => {
                    const div = document.createElement('div');
                    const userAnswer = userAnswers[i] === -1 ? "No answer" : q.answers[userAnswers[i]];
                    const correctAnswer = q.answers[q.correct];
                    const isCorrect = userAnswers[i] === q.correct;
                    div.textContent = `${i + 1}. ${q.question} - Your answer: ${userAnswer} (${isCorrect ? 'Correct' : 'Incorrect'})`;
                    if (!isCorrect) {
                        const correctSpan = document.createElement('span');
                        correctSpan.style.color = 'green';
                        correctSpan.textContent = ` Correct: ${correctAnswer}`;
                        div.appendChild(correctSpan);
                    }
                    scoreDetails.appendChild(div);
                });
                scorePage.style.display = 'block';
            }

            function endGame() {
                if (answersSubmitted.every(submitted => submitted)) {
                    showScorePage();
                }
            }

            function returnToMainPage() {
                document.getElementById('scorePage').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
                document.getElementById('score').textContent = 'Score: 0';
                currentQuestion = 0;
                score = 0;
                hasAnswered = false;
                answersSubmitted = [];
                userAnswers = [];
            }

            // Admin Logic
            function showPasswordPanel() {
                console.log('Admin button clicked');
                document.getElementById('startScreen').style.display = 'none';
                document.getElementById('passwordPanel').style.display = 'block';
                document.getElementById('adminPassword').value = '';
            }

            function closePasswordPanel() {
                console.log('Cancel password clicked');
                document.getElementById('passwordPanel').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
            }

            function verifyPassword() {
                console.log('Submit password clicked');
                try {
                    const password = document.getElementById('adminPassword').value.trim();
                    if (password === "1234") {
                        console.log('Password correct, opening admin panel');
                        document.getElementById('passwordPanel').style.display = 'none';
                        document.getElementById('adminPanel').style.display = 'block';
                        updateQuestionList();
                    } else {
                        console.log('Incorrect password');
                        alert("Incorrect password!");
                    }
                } catch (e) {
                    console.error('Error verifying password:', e);
                    alert('Error verifying password.');
                }
            }

            function closeAdmin() {
                console.log('Close admin clicked');
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('startScreen').style.display = 'block';
                editingIndex = -1;
                clearForm();
            }

            function saveQuestion() {
                console.log('Save question clicked');
                try {
                    const question = document.getElementById('newQuestion').value.trim();
                    const answers = [
                        document.getElementById('newAnswer1').value.trim(),
                        document.getElementById('newAnswer2').value.trim(),
                        document.getElementById('newAnswer3').value.trim(),
                        document.getElementById('newAnswer4').value.trim()
                    ];
                    const correct = parseInt(document.getElementById('correctAnswer').value);
                    const imageInput = document.getElementById('questionImageInput');
                    let image = '';
                    if (imageInput.files && imageInput.files[0]) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            image = e.target.result;
                            saveQuestionData({ question, answers, correct, image });
                        };
                        reader.readAsDataURL(imageInput.files[0]);
                    } else {
                        saveQuestionData({ question, answers, correct, image });
                    }
                } catch (e) {
                    console.error('Error saving question:', e);
                    alert('Error saving question.');
                }
            }

            function saveQuestionData({ question, answers, correct, image }) {
                if (!question) {
                    alert("Question cannot be empty!");
                    return;
                }
                if (answers.some(a => !a)) {
                    alert("All answers must be filled!");
                    return;
                }
                if (isNaN(correct) || correct < 0 || correct > 3) {
                    alert("Select a valid correct answer!");
                    return;
                }
                if (question.length > 100 || answers.some(a => a.length > 50)) {
                    alert("Question or answers too long!");
                    return;
                }
                if (editingIndex === -1) {
                    originalQuestions.push({ question, answers, correct, image });
                    console.log('Question added:', question);
                    alert("Question added!");
                } else {
                    originalQuestions[editingIndex] = { question, answers, correct, image };
                    console.log('Question edited:', question);
                    alert("Question updated!");
                    editingIndex = -1;
                }
                updateQuestionList();
                clearForm();
            }

            function editQuestion(index) {
                console.log(`Edit question ${index} clicked`);
                try {
                    editingIndex = index;
                    const q = originalQuestions[index];
                    document.getElementById('newQuestion').value = q.question;
                    document.getElementById('newAnswer1').value = q.answers[0];
                    document.getElementById('newAnswer2').value = q.answers[1];
                    document.getElementById('newAnswer3').value = q.answers[2];
                    document.getElementById('newAnswer4').value = q.answers[3];
                    document.getElementById('correctAnswer').value = q.correct;
                    document.getElementById('questionImageInput').value = '';
                    document.getElementById('adminPanel').scrollIntoView();
                } catch (e) {
                    console.error('Error editing question:', e);
                    alert('Error editing question.');
                }
            }

            function removeQuestion(index) {
                console.log(`Remove question ${index} clicked`);
                try {
                    if (confirm('Are you sure you want to delete this question?')) {
                        originalQuestions.splice(index, 1);
                        console.log('Question removed');
                        updateQuestionList();
                        alert('Question deleted!');
                    }
                } catch (e) {
                    console.error('Error removing question:', e);
                    alert('Error removing question.');
                }
            }

            function updateQuestionList() {
                console.log('Updating question list');
                try {
                    const questionList = document.getElementById('questionList');
                    questionList.innerHTML = '';
                    originalQuestions.forEach((q, i) => {
                        const div = document.createElement('div');
                        const truncated = q.question.length > 30 ? q.question.substring(0, 27) + '...' : q.question;
                        div.textContent = `${i + 1}. ${truncated}`;
                        const editBtn = document.createElement('button');
                        editBtn.textContent = 'Edit';
                        editBtn.onclick = () => editQuestion(i);
                        const deleteBtn = document.createElement('button');
                        deleteBtn.textContent = 'Delete';
                        deleteBtn.onclick = () => removeQuestion(i);
                        div.appendChild(editBtn);
                        div.appendChild(deleteBtn);
                        questionList.appendChild(div);
                    });
                } catch (e) {
                    console.error('Error updating question list:', e);
                    alert('Error updating question list.');
                }
            }

            function clearForm() {
                document.getElementById('newQuestion').value = '';
                document.getElementById('questionImageInput').value = '';
                document.getElementById('newAnswer1').value = '';
                document.getElementById('newAnswer2').value = '';
                document.getElementById('newAnswer3').value = '';
                document.getElementById('newAnswer4').value = '';
                document.getElementById('correctAnswer').value = '0';
            }

            // Initialize
            try {
                initThreeJS();

                document.getElementById('singlePlayerBtn').onclick = () => {
                    console.log('Single-player button clicked');
                    gameMode = 'single';
                    document.getElementById('startScreen').style.display = 'none';
                    shuffleQuestionsAndAnswers();
                    showQuestion(0);
                };

                document.getElementById('practiceBtn').onclick = () => {
                    console.log('Practice button clicked');
                    gameMode = 'practice';
                    document.getElementById('startScreen').style.display = 'none';
                    shuffleQuestionsAndAnswers();
                    showQuestion(0);
                };

                document.getElementById('adminBtn').onclick = () => {
                    console.log('Admin button clicked');
                    showPasswordPanel();
                };

                document.getElementById('submitPasswordBtn').onclick = () => {
                    console.log('Submit password button clicked');
                    verifyPassword();
                };

                document.getElementById('cancelPasswordBtn').onclick = () => {
                    console.log('Cancel password clicked');
                    closePasswordPanel();
                };

                document.getElementById('saveQuestionBtn').onclick = () => {
                    console.log('Save question button clicked');
                    saveQuestion();
                };

                document.getElementById('closeAdminBtn').onclick = () => {
                    console.log('Close admin clicked');
                    closeAdmin();
                };

                document.getElementById('cheatModeCheckbox').onchange = () => {
                    cheatMode = document.getElementById('cheatModeCheckbox').checked;
                    console.log('Cheat mode:', cheatMode ? 'enabled' : 'disabled');
                };

                document.getElementById('prevBtn').onclick = () => {
                    if (currentQuestion > 0) {
                        currentQuestion--;
                        showQuestion(currentQuestion);
                    }
                };

                document.getElementById('nextBtn').onclick = () => {
                    if (currentQuestion < questions.length - 1 && answersSubmitted[currentQuestion]) {
                        currentQuestion++;
                        showQuestion(currentQuestion);
                    } else if (currentQuestion === questions.length - 1 && answersSubmitted[currentQuestion]) {
                        endGame();
                    }
                };

                document.getElementById('finishBtn').onclick = () => {
                    console.log('Finish button clicked');
                    returnToMainPage();
                };

                console.log('Event listeners attached successfully');
            } catch (e) {
                console.error('Error during initialization:', e);
                alert('Failed to initialize game. Please refresh the page.');
            }
        };
    </script>
</body>
</html>